version: '3.8'

services:
  node-0:
    build: .
    container_name: raft-node-0
    command: >
      python run_node.py
      --node-id node-0
      --port 8000
      --peers node-1,node-2,node-3,node-4
      --storage-dir /data
      --host 0.0.0.0
    volumes:
      - ./data/node-0:/data
    ports:
      - "8000:8000"
    networks:
      - raft-network
    restart: unless-stopped

  node-1:
    build: .
    container_name: raft-node-1
    command: >
      python run_node.py
      --node-id node-1
      --port 8000
      --peers node-0,node-2,node-3,node-4
      --storage-dir /data
      --host 0.0.0.0
    volumes:
      - ./data/node-1:/data
    ports:
      - "8001:8000"
    networks:
      - raft-network
    restart: unless-stopped

  node-2:
    build: .
    container_name: raft-node-2
    command: >
      python run_node.py
      --node-id node-2
      --port 8000
      --peers node-0,node-1,node-3,node-4
      --storage-dir /data
      --host 0.0.0.0
    volumes:
      - ./data/node-2:/data
    ports:
      - "8002:8000"
    networks:
      - raft-network
    restart: unless-stopped

  node-3:
    build: .
    container_name: raft-node-3
    command: >
      python run_node.py
      --node-id node-3
      --port 8000
      --peers node-0,node-1,node-2,node-4
      --storage-dir /data
      --host 0.0.0.0
    volumes:
      - ./data/node-3:/data
    ports:
      - "8003:8000"
    networks:
      - raft-network
    restart: unless-stopped

  node-4:
    build: .
    container_name: raft-node-4
    command: >
      python run_node.py
      --node-id node-4
      --port 8000
      --peers node-0,node-1,node-2,node-3
      --storage-dir /data
      --host 0.0.0.0
    volumes:
      - ./data/node-4:/data
    ports:
      - "8004:8000"
    networks:
      - raft-network
    restart: unless-stopped

networks:
  raft-network:
    driver: bridge
